<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fourier's Law - 3D Cylindrical Pipe Heat Conduction</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border-left: 5px solid #3498db;
            border-right: 5px solid #3498db;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
            background: linear-gradient(45deg, #3498db, #2c3e50);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.8;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1100px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.97);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            border-top: 5px solid #3498db;
        }
        
        .controls-panel {
            grid-column: 1;
        }
        
        .visualization-panel {
            grid-column: 2;
            display: flex;
            flex-direction: column;
        }
        
        @media (max-width: 1100px) {
            .controls-panel, .visualization-panel {
                grid-column: 1;
            }
        }
        
        .section-title {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: #3498db;
        }
        
        .input-group {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            transition: all 0.3s ease;
        }
        
        .input-group:hover {
            background: #edf2f7;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.1);
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }
        
        .value-display {
            min-width: 100px;
            padding: 8px 15px;
            background: #3498db;
            color: white;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 3px 10px rgba(52, 152, 219, 0.3);
        }
        
        /* 3D Visualization Container */
        #pipe3d-container {
            width: 100%;
            height: 350px;
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 2px solid #3498db;
            position: relative;
        }
        
        #pipe3d {
            width: 100%;
            height: 100%;
        }
        
        .visual-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .visual-btn {
            flex: 1;
            padding: 10px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .visual-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .visual-btn.active {
            background: #2c3e50;
            box-shadow: 0 0 15px rgba(44, 62, 80, 0.3);
        }
        
        /* Calculation Steps */
        .calculation-steps {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid #3498db;
        }
        
        .step {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 5px solid #3498db;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        
        .step:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .step-title {
            display: inline-block;
            color: #2c3e50;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .step-content {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            color: #2c3e50;
        }
        
        .highlight {
            color: #e74c3c;
            font-weight: bold;
        }
        
        /* Results Panel */
        .results-panel {
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-top: 4px solid;
        }
        
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .result-card h4 {
            color: #7f8c8d;
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .result-unit {
            color: #3498db;
            font-size: 0.9rem;
        }
        
        /* Charts */
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .chart-title {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2rem;
        }
        
        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .slider-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .value-display {
                align-self: center;
            }
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .panel, .result-card, .step {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* Info Box */
        .info-box {
            background: #e3f2fd;
            border-left: 5px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .color-hot { background: linear-gradient(45deg, #ff6b6b, #ee5a24); }
        .color-warm { background: linear-gradient(45deg, #ffa726, #f57c00); }
        .color-cool { background: linear-gradient(45deg, #4ecdc4, #26a69a); }
        .color-cold { background: linear-gradient(45deg, #3498db, #2980b9); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üî¨ Fourier's Law: Heat Conduction in Cylindrical Pipes</h1>
            <p class="subtitle">Interactive 3D visualization and step-by-step calculation of temperature distribution in cylindrical coordinates</p>
        </header>
        
        <div class="content">
            <!-- Controls Panel -->
            <div class="panel controls-panel">
                <h2 class="section-title">‚öôÔ∏è Pipe Parameters & Material Properties</h2>
                
                <div class="input-group">
                    <label>Inner Radius (r‚ÇÅ)</label>
                    <div class="slider-container">
                        <input type="range" id="innerRadius" min="0.01" max="0.2" step="0.01" value="0.05">
                        <div class="value-display" id="innerRadiusValue">0.05 m</div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Outer Radius (r‚ÇÇ)</label>
                    <div class="slider-container">
                        <input type="range" id="outerRadius" min="0.05" max="0.3" step="0.01" value="0.1">
                        <div class="value-display" id="outerRadiusValue">0.1 m</div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Inner Temperature (T‚ÇÅ)</label>
                    <div class="slider-container">
                        <input type="range" id="innerTemp" min="0" max="300" step="5" value="100">
                        <div class="value-display" id="innerTempValue">100 ¬∞C</div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Outer Temperature (T‚ÇÇ)</label>
                    <div class="slider-container">
                        <input type="range" id="outerTemp" min="0" max="100" step="5" value="20">
                        <div class="value-display" id="outerTempValue">20 ¬∞C</div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Thermal Conductivity (k)</label>
                    <div class="slider-container">
                        <input type="range" id="conductivity" min="1" max="400" step="1" value="50">
                        <div class="value-display" id="conductivityValue">50 W/m¬∑K</div>
                    </div>
                    <div class="info-box">
                        <strong>Material Examples:</strong><br>
                        Copper: 385 W/m¬∑K | Steel: 50 W/m¬∑K | Glass: 1 W/m¬∑K | Wood: 0.1 W/m¬∑K
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Pipe Length (L)</label>
                    <div class="slider-container">
                        <input type="range" id="pipeLength" min="0.1" max="5" step="0.1" value="1">
                        <div class="value-display" id="pipeLengthValue">1 m</div>
                    </div>
                </div>
                
                <!-- Legend for Temperature Colors -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color color-hot"></div>
                        <span>Hot (High Temp)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-warm"></div>
                        <span>Warm</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-cool"></div>
                        <span>Cool</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-cold"></div>
                        <span>Cold (Low Temp)</span>
                    </div>
                </div>
            </div>
            
            <!-- 3D Visualization Panel -->
            <div class="panel visualization-panel">
                <h2 class="section-title">üå°Ô∏è 3D Pipe Visualization</h2>
                
                <div id="pipe3d-container">
                    <div id="pipe3d"></div>
                </div>
                
                <div class="visual-controls">
                    <button class="visual-btn active" id="view3d">3D View</button>
                    <button class="visual-btn" id="viewCrossSection">Cross Section</button>
                    <button class="visual-btn" id="viewTemperature">Temperature Gradient</button>
                    <button class="visual-btn" id="rotateToggle">Auto Rotate: ON</button>
                </div>
                
                <!-- Calculation Steps -->
                <div class="calculation-steps">
                    <h2 class="section-title">üìù Step-by-Step Calculation</h2>
                    
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-title">Calculate Logarithmic Ratio</div>
                        <div class="step-content">
                            ln(r‚ÇÇ/r‚ÇÅ) = ln(<span id="step1_r2">0.1</span>/<span id="step1_r1">0.05</span>)<br>
                            = ln(<span id="step1_ratio">2.00</span>) = <span class="highlight" id="step1_result">0.693</span>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-title">Calculate Thermal Resistance</div>
                        <div class="step-content">
                            R_th = ln(r‚ÇÇ/r‚ÇÅ) / (2œÄ √ó k √ó L)<br>
                            = <span id="step2_ln">0.693</span> / (2œÄ √ó <span id="step2_k">50</span> √ó <span id="step2_L">1</span>)<br>
                            = <span class="highlight" id="step2_result">0.0022 K/W</span>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-title">Calculate Heat Transfer Rate</div>
                        <div class="step-content">
                            Q = (T‚ÇÅ - T‚ÇÇ) / R_th<br>
                            = (<span id="step3_T1">100</span> - <span id="step3_T2">20</span>) / <span id="step3_R">0.0022</span><br>
                            = <span class="highlight" id="step3_result">1570.8 W</span>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-title">Temperature Distribution Function</div>
                        <div class="step-content">
                            T(r) = T‚ÇÅ + ((T‚ÇÇ - T‚ÇÅ) / ln(r‚ÇÇ/r‚ÇÅ)) √ó ln(r/r‚ÇÅ)<br>
                            T(r) = <span id="step4_T1">100</span> + ((<span id="step4_T2">20</span>-<span id="step4_T1b">100</span>)/<span id="step4_ln">0.693</span>) √ó ln(r/<span id="step4_r1">0.05</span>)<br>
                            T(r) = <span class="highlight" id="step4_result">100 - 115.5 √ó ln(r/0.05)</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Results Panel -->
            <div class="panel results-panel">
                <h2 class="section-title">üìä Results & Analysis</h2>
                
                <div class="results-grid">
                    <div class="result-card" style="border-color: #e74c3c;">
                        <h4>Heat Transfer Rate</h4>
                        <div class="result-value" id="heatRateValue">1570.8</div>
                        <div class="result-unit">Watts (W)</div>
                        <p>Energy transferred per second</p>
                    </div>
                    
                    <div class="result-card" style="border-color: #3498db;">
                        <h4>Thermal Resistance</h4>
                        <div class="result-value" id="resistanceValue">0.0022</div>
                        <div class="result-unit">K/W</div>
                        <p>Resistance to heat flow</p>
                    </div>
                    
                    <div class="result-card" style="border-color: #2ecc71;">
                        <h4>Temperature Gradient</h4>
                        <div class="result-value" id="gradientValue">115.5</div>
                        <div class="result-unit">¬∞C/m</div>
                        <p>Rate of temperature change</p>
                    </div>
                    
                    <div class="result-card" style="border-color: #f39c12;">
                        <h4>Heat Flux at Inner Surface</h4>
                        <div class="result-value" id="fluxValue">49956</div>
                        <div class="result-unit">W/m¬≤</div>
                        <p>Heat flow per unit area</p>
                    </div>
                </div>
                
                <!-- Temperature Distribution Chart -->
                <div class="chart-container">
                    <h3 class="chart-title">üìà Temperature Distribution vs Radius</h3>
                    <canvas id="temperatureChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const sliders = {
            innerRadius: document.getElementById('innerRadius'),
            outerRadius: document.getElementById('outerRadius'),
            innerTemp: document.getElementById('innerTemp'),
            outerTemp: document.getElementById('outerTemp'),
            conductivity: document.getElementById('conductivity'),
            pipeLength: document.getElementById('pipeLength')
        };

        const valueDisplays = {
            innerRadius: document.getElementById('innerRadiusValue'),
            outerRadius: document.getElementById('outerRadiusValue'),
            innerTemp: document.getElementById('innerTempValue'),
            outerTemp: document.getElementById('outerTempValue'),
            conductivity: document.getElementById('conductivityValue'),
            pipeLength: document.getElementById('pipeLengthValue')
        };

        const resultDisplays = {
            heatRate: document.getElementById('heatRateValue'),
            resistance: document.getElementById('resistanceValue'),
            gradient: document.getElementById('gradientValue'),
            flux: document.getElementById('fluxValue')
        };

        const stepElements = {
            step1: document.querySelectorAll('#step1_r1, #step1_r2, #step1_ratio, #step1_result'),
            step2: document.querySelectorAll('#step2_ln, #step2_k, #step2_L, #step2_result'),
            step3: document.querySelectorAll('#step3_T1, #step3_T2, #step3_R, #step3_result'),
            step4: document.querySelectorAll('#step4_T1, #step4_T2, #step4_T1b, #step4_ln, #step4_r1, #step4_result')
        };

        // Three.js Variables
        let scene, camera, renderer, controls, pipeMesh;
        let isRotating = true;
        let viewMode = '3d';

        // Initialize 3D Scene
        function init3D() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a192f);
            
            camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);
            camera.position.set(2, 2, 2);
            
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(document.getElementById('pipe3d-container').offsetWidth, 
                            document.getElementById('pipe3d-container').offsetHeight);
            document.getElementById('pipe3d').appendChild(renderer.domElement);
            
            // Add lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            
            // Add controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // Create pipe
            createPipe();
            
            // Handle window resize
            window.addEventListener('resize', onWindowResize);
            
            // Start animation
            animate();
        }

        // Create pipe geometry with temperature visualization
        function createPipe() {
            if (pipeMesh) {
                scene.remove(pipeMesh);
            }
            
            const r1 = parseFloat(sliders.innerRadius.value);
            const r2 = parseFloat(sliders.outerRadius.value);
            const T1 = parseFloat(sliders.innerTemp.value);
            const T2 = parseFloat(sliders.outerTemp.value);
            const L = parseFloat(sliders.pipeLength.value);
            
            // Create cylindrical pipe
            const geometry = new THREE.CylinderGeometry(r2, r2, L, 32, 32, true);
            const innerGeometry = new THREE.CylinderGeometry(r1, r1, L, 32, 32, true);
            
            // Create material with temperature-based colors
            const material = new THREE.MeshPhongMaterial({ 
                color: 0x3498db,
                transparent: true,
                opacity: 0.8,
                side: THREE.DoubleSide
            });
            
            const innerMaterial = new THREE.MeshPhongMaterial({
                color: 0xe74c3c,
                transparent: true,
                opacity: 0.9
            });
            
            // Create pipe mesh
            const pipe = new THREE.Mesh(geometry, material);
            const innerPipe = new THREE.Mesh(innerGeometry, innerMaterial);
            
            // Group them
            pipeMesh = new THREE.Group();
            pipeMesh.add(pipe);
            pipeMesh.add(innerPipe);
            
            // Add temperature gradient visualization
            addTemperatureGradient(r1, r2, T1, T2, L);
            
            scene.add(pipeMesh);
        }

        // Add temperature gradient visualization
        function addTemperatureGradient(r1, r2, T1, T2, L) {
            const segments = 20;
            const deltaR = (r2 - r1) / segments;
            
            for (let i = 0; i <= segments; i++) {
                const r = r1 + i * deltaR;
                const t = T1 + (T2 - T1) * Math.log(r / r1) / Math.log(r2 / r1);
                
                // Map temperature to color
                const color = getTemperatureColor(t, T1, T2);
                
                const ringGeometry = new THREE.RingGeometry(r - 0.001, r + 0.001, 32);
                const ringMaterial = new THREE.MeshBasicMaterial({ 
                    color: color,
                    transparent: true,
                    opacity: 0.7
                });
                
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.rotation.x = Math.PI / 2;
                ring.position.y = L / 2;
                
                scene.add(ring);
            }
        }

        // Convert temperature to color
        function getTemperatureColor(temp, T1, T2) {
            const normalized = (temp - T2) / (T1 - T2);
            
            if (normalized > 0.75) return new THREE.Color(0xff6b6b); // Hot red
            if (normalized > 0.5) return new THREE.Color(0xffa726); // Warm orange
            if (normalized > 0.25) return new THREE.Color(0x4ecdc4); // Cool teal
            return new THREE.Color(0x3498db); // Cold blue
        }

        // Window resize handler
        function onWindowResize() {
            const container = document.getElementById('pipe3d-container');
            camera.aspect = container.offsetWidth / container.offsetHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.offsetWidth, container.offsetHeight);
        }

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            if (isRotating && pipeMesh) {
                pipeMesh.rotation.y += 0.005;
            }
            
            controls.update();
            renderer.render(scene, camera);
        }

        // Initialize Chart.js
        const ctx = document.getElementById('temperatureChart').getContext('2d');
        let temperatureChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Temperature (¬∞C)',
                    data: [],
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 14
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `Temperature: ${context.parsed.y.toFixed(1)}¬∞C at r = ${context.label}m`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Radius from Center (m)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Temperature (¬∞C)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    }
                }
            }
        });

        // Update all displays and calculations
        function updateAll() {
            // Get current values
            const r1 = parseFloat(sliders.innerRadius.value);
            const r2 = parseFloat(sliders.outerRadius.value);
            const T1 = parseFloat(sliders.innerTemp.value);
            const T2 = parseFloat(sliders.outerTemp.value);
            const k = parseFloat(sliders.conductivity.value);
            const L = parseFloat(sliders.pipeLength.value);
            
            // Update value displays
            valueDisplays.innerRadius.textContent = `${r1.toFixed(2)} m`;
            valueDisplays.outerRadius.textContent = `${r2.toFixed(2)} m`;
            valueDisplays.innerTemp.textContent = `${T1} ¬∞C`;
            valueDisplays.outerTemp.textContent = `${T2} ¬∞C`;
            valueDisplays.conductivity.textContent = `${k} W/m¬∑K`;
            valueDisplays.pipeLength.textContent = `${L} m`;
            
            // Perform calculations
            const ln_r2_r1 = Math.log(r2 / r1);
            const R_th = ln_r2_r1 / (2 * Math.PI * k * L);
            const Q = (T1 - T2) / R_th;
            const gradient = (T2 - T1) / ln_r2_r1;
            const flux_inner = Q / (2 * Math.PI * r1 * L);
            
            // Update result displays
            resultDisplays.heatRate.textContent = Q.toFixed(1);
            resultDisplays.resistance.textContent = R_th.toFixed(4);
            resultDisplays.gradient.textContent = Math.abs(gradient).toFixed(1);
            resultDisplays.flux.textContent = flux_inner.toFixed(0);
            
            // Update calculation steps
            updateCalculationSteps(r1, r2, T1, T2, k, L, ln_r2_r1, R_th, Q, gradient);
            
            // Update 3D visualization
            createPipe();
            
            // Update chart
            updateChart(r1, r2, T1, T2, ln_r2_r1);
        }

        // Update calculation steps
        function updateCalculationSteps(r1, r2, T1, T2, k, L, ln_r2_r1, R_th, Q, gradient) {
            // Step 1
            document.getElementById('step1_r1').textContent = r1.toFixed(2);
            document.getElementById('step1_r2').textContent = r2.toFixed(2);
            document.getElementById('step1_ratio').textContent = (r2/r1).toFixed(2);
            document.getElementById('step1_result').textContent = ln_r2_r1.toFixed(3);
            
            // Step 2
            document.getElementById('step2_ln').textContent = ln_r2_r1.toFixed(3);
            document.getElementById('step2_k').textContent = k;
            document.getElementById('step2_L').textContent = L;
            document.getElementById('step2_result').textContent = R_th.toFixed(4);
            
            // Step 3
            document.getElementById('step3_T1').textContent = T1;
            document.getElementById('step3_T2').textContent = T2;
            document.getElementById('step3_R').textContent = R_th.toFixed(4);
            document.getElementById('step3_result').textContent = Q.toFixed(1);
            
            // Step 4
            document.getElementById('step4_T1').textContent = T1;
            document.getElementById('step4_T2').textContent = T2;
            document.getElementById('step4_T1b').textContent = T1;
            document.getElementById('step4_ln').textContent = ln_r2_r1.toFixed(3);
            document.getElementById('step4_r1').textContent = r1.toFixed(2);
            document.getElementById('step4_result').textContent = 
                `${T1.toFixed(0)} ${gradient >= 0 ? '+' : '-'} ${Math.abs(gradient).toFixed(1)} √ó ln(r/${r1.toFixed(2)})`;
        }

        // Update temperature distribution chart
        function updateChart(r1, r2, T1, T2, ln_r2_r1) {
            const radii = [];
            const temperatures = [];
            const steps = 50;
            
            for (let i = 0; i <= steps; i++) {
                const r = r1 + (r2 - r1) * (i / steps);
                radii.push(r.toFixed(3));
                
                const T = T1 + ((T2 - T1) / ln_r2_r1) * Math.log(r / r1);
                temperatures.push(T);
            }
            
            temperatureChart.data.labels = radii;
            temperatureChart.data.datasets[0].data = temperatures;
            temperatureChart.update();
        }

        // Event Listeners
        Object.keys(sliders).forEach(key => {
            sliders[key].addEventListener('input', function() {
                // Validate radius constraints
                if (key === 'innerRadius' && parseFloat(this.value) >= parseFloat(sliders.outerRadius.value)) {
                    this.value = parseFloat(sliders.outerRadius.value) - 0.01;
                }
                if (key === 'outerRadius' && parseFloat(this.value) <= parseFloat(sliders.innerRadius.value)) {
                    this.value = parseFloat(sliders.innerRadius.value) + 0.01;
                }
                updateAll();
            });
        });

        // 3D View Controls
        document.getElementById('view3d').addEventListener('click', function() {
            viewMode = '3d';
            updateViewButtons();
            // Reset camera position for 3D view
            camera.position.set(2, 2, 2);
            controls.update();
        });
